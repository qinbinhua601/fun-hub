{"version":3,"sources":["index.js"],"names":["Vue","component","VueInfiniteLoading","default","indexView","el","name","data","showDropdown","list","hasMore","favoriteList","localStorage","getItem","JSON","parse","searchingText","categories","text","value","currentId","selected","searchedList","computed","filteredList","methods","getMore","axios","get","params","cate","page","q","then","status","concat","map","item","isFavorite","includes","aid","searchedText","title","replace","navView","videoCount","length","$refs","infiniteLoading","$emit","addToFavorite","push","setItem","stringify","removeFromFavorite","index","findIndex","i","splice","resetCate","onInputHandler","mounted","_","debounce"],"mappings":"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","file":"index.js","sourcesContent":["Vue.component(\"vue-infinite-loading\", VueInfiniteLoading.default);\r\nlet indexView = new Vue({\r\n  el: \"#app\",\r\n  name: \"app\",\r\n  data: {\r\n    showDropdown: false,\r\n    list: [],\r\n    hasMore: true,\r\n    favoriteList: localStorage.getItem(\"favoriteList\")\r\n      ? JSON.parse(localStorage.getItem(\"favoriteList\"))\r\n      : [],\r\n    searchingText: \"\",\r\n    categories: {\r\n      0: {\r\n        text: \"日剧\",\r\n        value: 0,\r\n        currentId: 0\r\n      },\r\n      1: {\r\n        text: \"动漫\",\r\n        value: 1,\r\n        currentId: 0\r\n      },\r\n      // 2: {\r\n      //   text: \"fixsub\",\r\n      //   value: 2,\r\n      //   currentId: 0\r\n      // },\r\n      3: {\r\n        text: \"QQ\",\r\n        value: 3,\r\n        currentId: 0\r\n      },\r\n      4: {\r\n        text: '推荐',\r\n        value: 4,\r\n        currentId: 0\r\n      },\r\n      5: {\r\n        text: '优酷动漫',\r\n        value: 5,\r\n        currentId: 0\r\n      }\r\n    },\r\n    selected: localStorage.getItem(\"defaultCate\")\r\n      ? JSON.parse(localStorage.getItem(\"defaultCate\"))\r\n      : 0,\r\n    searchedList: []\r\n  },\r\n  computed: {\r\n    filteredList() {\r\n      return this.searchingText ? this.searchedList : this.list;\r\n      // var result = [];\r\n      // this.list.forEach((item, index) => {\r\n      //   if (this.list[index].title.indexOf(this.searchingText) !== -1) {\r\n      //     item.searchedText = item.title.replace(this.searchingText, `<mark>${this.searchingText}</mark>`);\r\n      //     if (!this.searchingText) {\r\n      //       item.searchedText = item.title\r\n      //     }\r\n      //     result.push(item);\r\n      //   }\r\n      // });\r\n      // return result;\r\n    },\r\n    currentId() {\r\n      return this.categories[+this.selected].currentId;\r\n    }\r\n  },\r\n  methods: {\r\n    getMore() {\r\n      if (!this.hasMore) {\r\n        return\r\n      }\r\n      this.categories[this.selected].currentId =\r\n        this.categories[this.selected].currentId + 1;\r\n      axios\r\n        .get(\"/index/search\", {\r\n          params: {\r\n            cate: this.selected,\r\n            page: this.currentId,\r\n            q: this.searchingText\r\n          }\r\n        })\r\n        .then(({ status, data }) => {\r\n          if (this.searchingText) {\r\n            this.searchedList = this.searchedList.concat(\r\n              data.map(item => {\r\n                item.isFavorite = this.favoriteList.includes(item.aid);\r\n                item.searchedText = item.title.replace(this.searchingText, `<mark>${this.searchingText}</mark>`);\r\n                return item;\r\n              })\r\n            );\r\n            navView.videoCount = this.searchedList.length;\r\n            if (data.length) {\r\n              this.$refs.infiniteLoading.$emit(\"$InfiniteLoading:loaded\");\r\n            } else {\r\n              this.$refs.infiniteLoading.$emit(\"$InfiniteLoading:complete\");\r\n              this.hasMore = false\r\n            }\r\n            return\r\n          }\r\n          if (data.length) {\r\n            this.list = this.list.concat(\r\n              data.map(item => {\r\n                item.isFavorite = this.favoriteList.includes(item.aid);\r\n                item.searchedText = item.title;\r\n                return item;\r\n              })\r\n            );\r\n          }\r\n          navView.videoCount = this.list.length;\r\n          if (data.length) {\r\n            this.$refs.infiniteLoading.$emit(\"$InfiniteLoading:loaded\");\r\n          } else {\r\n            this.$refs.infiniteLoading.$emit(\"$InfiniteLoading:complete\");\r\n            this.hasMore = false\r\n          }\r\n        });\r\n    },\r\n    addToFavorite(item) {\r\n      this.favoriteList.push(item.aid);\r\n      localStorage.setItem(\"favoriteList\", JSON.stringify(this.favoriteList));\r\n    },\r\n    removeFromFavorite(item) {\r\n      var index = this.favoriteList.findIndex(function(i) {\r\n        return i === item.aid;\r\n      });\r\n      this.favoriteList.splice(index, 1);\r\n      localStorage.setItem(\"favoriteList\", JSON.stringify(this.favoriteList));\r\n    },\r\n    resetCate(item) {\r\n      item.currentId = 0;\r\n      this.list = [];\r\n      this.showDropdown = false;\r\n      this.selected = item.value;\r\n      this.searchingText = '';\r\n      this.$refs.infiniteLoading.$emit(\"$InfiniteLoading:reset\");\r\n      localStorage.setItem(\"defaultCate\", JSON.stringify(this.selected));\r\n      this.hasMore = true;\r\n      this.getMore();\r\n    },\r\n    onInputHandler() {}\r\n  },\r\n  mounted() {\r\n    this.onInputHandler = _.debounce(() => {\r\n      this.categories[this.selected].currentId = 0;\r\n      this.showDropdown = false;\r\n      this.$refs.infiniteLoading.$emit(\"$InfiniteLoading:reset\");\r\n      this.hasMore = true;\r\n      if (this.searchingText) {\r\n        this.searchedList = [];\r\n        this.getMore()\r\n      } else {\r\n        this.list = [];\r\n      }\r\n    }, 300)\r\n  }\r\n});"]}